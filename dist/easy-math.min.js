"use strict";angular.module("easyMath",["ngRoute","ngAnimate","ngCookies","ipCookie","easyMath.filters","easyMath.services","easyMath.directives","easyMath.controllers","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/home",{templateUrl:"partials/home.html",controller:"HomeController"}),a.when("/play",{templateUrl:"partials/play.html",controller:"PlayController"}),a.when("/about",{templateUrl:"partials/about.html",controller:"HomeController"}),a.when("/classic",{templateUrl:"partials/mode-classic.html",controller:"TimelimitController"}),a.when("/timelimit",{templateUrl:"partials/mode-timelimit.html",controller:"TimelimitController"}),a.when("/highscores",{templateUrl:"partials/highscores.html",controller:"HomeController"}),a.otherwise({redirectTo:"/home"})}]),angular.module("easyMath.controllers",[]).controller("HomeController",["$scope","$timeout","$interval","$location","$anchorScroll","QuestionsService","DatabaseService","HighScoreService",function(a,b,c,d,e,f,g,h){a.questions=null,a.currentQuestion=null,a.playerName=h.playerName,a.$watch(function(){return h.timelimitUpdated},function(){console.log("Timelimit updated"),a.timelimitScores=h.timelimitScores}),a.$watch(function(){return h.classicUpdated},function(){console.log("Classic updated"),a.classicScores=h.classicScores}),a.init=function(){a.previewEnabled=!0,a.generateQuestion(),c(a.generateQuestion,3e3),b(a.solveQuestion,1500),h.init()},a.generateQuestion=function(){"/home"===d.path()&&(a.currentQuestion=f.generateQuestion(1),a.rotatePreview())},a.solveQuestion=function(){var c=1===i(2)?"<":">";a.currentQuestion&&(a.currentQuestion.answer=c,a.currentQuestion.isTrue=f.checkAnswer(a.currentQuestion,a.currentQuestion.answer),b(a.solveQuestion,3e3))},a.rotatePreview=function(){a.option1=angular.element("#option1"),a.option2=angular.element("#option2");var b=function(){a.option1.addClass("change"),setTimeout(function(){a.option2.addClass("change")},100)},c=function(){a.option1.removeClass("change"),a.option2.removeClass("change")};a.option2.hasClass("change")&&c(),b(),setTimeout(function(){c()},500)};var i=function(a){return Math.floor(Math.random()*a)};a.learnMoreScroll=function(){d.hash("more-info"),e()},a.updateHighscores=function(){h.fetchTimelimit()},a.init()}]).controller("PlayController",["$scope","QuestionsService",function(a){a.$watch("$viewContentLoaded",function(){})}]).controller("TimelimitController",["$scope","$route","$timeout","$interval","$location","QuestionsService","TimerService","GameClassicFactory","SoundsService","DatabaseService","NameService","HighScoreService","$cookies","$cookieStore","ipCookie",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.game=h,a.mode=null,a.highscores=null,a.mute={music:!1,sounds:!1},a.$watch("$viewContentLoaded",function(){a.init()}),a.$watch(function(){return l.timelimitUpdated},function(){a.highscores=l.timelimitScores}),a.$watch(function(){return l.classicUpdated},function(){a.highscores=l.classicScores}),a.$watch(function(){return h.gameStatus},function(b){if(a.gameStatus=b,3==a.gameStatus){angular.element(".score").addClass("final"),a.final=h.final,i.playFinish();var d;l.playerName?(console.log("We have a name: "+l.playerName),d=l.playerName):(console.log("Generating a name"),d=k.getName(),l.playerName=d,o("playerName",d,{expires:365}));var e=[null,d,a.game.score,(new Date).toDateString(),"ip here"],f="classic"==a.mode.type?"score_classic":"score_timelimit";a.currentScore=e,j.addTableData(f,e,function(){a.currentScore[0]=j.getLatestAddedId(),"timelimit"==a.mode.type?(o("timelimitScore",a.score),l.fetchTimelimit(),c(l.fetchTimelimit,300)):"classic"==a.mode.type&&(o("classicScore",a.score),l.fetchClassic(),c(l.fetchClassic,300))})}}),a.init=function(){a.HighScoreService=l,l.init(),"partials/mode-classic.html"===b.current.templateUrl?(a.mode={type:"classic",time:{min:1,sec:30}},l.fetchClassic()):"partials/mode-timelimit.html"===b.current.templateUrl&&(a.mode={type:"timelimit",time:{min:0,sec:30}},l.fetchTimelimit()),h.initGame(f,g,a.mode.time),i.playTheme(),a.currentQuestion=h.currentQuestion,document.addEventListener("keyup",a.keyIsDown,!1)},a.startGame=function(){a.questions=new Array,h.start()},a.skipQuestion=function(){h.skipQuestion(h.currentQuestion)},a.setAnswer=function(b){if(2===a.game.gameStatus){a.rotateQuestions(),a.updateScore(),h.currentQuestion.answer=b;var c=f.checkAnswer(h.currentQuestion,b);h.nextQuestion(),a.modeSpecialOnAnswer(c)}},a.modeSpecialOnAnswer=function(b){switch(b?(h.score+=h.questionPoints,i.playSuccess()):(h.TimerService.addTime(0,-1),h.score-=h.questionPoints/2,i.playError()),a.mode.type){case"classic":break;case"timelimit":b&&h.TimerService.addTime(0,.5)}},a.changeMute=function(){i.mute(a.mute)},a.rotateQuestions=function(){(void 0===a.option1||void 0===a.option2)&&(a.option1=angular.element("#option1"),a.option2=angular.element("#option2"));var b=function(){a.option1.addClass("change"),setTimeout(function(){a.option2.addClass("change")},100)},c=function(){a.option1.removeClass("change"),a.option2.removeClass("change")};b(),setTimeout(function(){c()},600)},a.updateScore=function(){a.scoreDiv=angular.element(".score");var b=function(){a.scoreDiv.addClass("update")},c=function(){a.scoreDiv.removeClass("update")};b(),setTimeout(function(){c()},600)},a.keyIsDown=function(b){var c="number"==typeof b.which?b.which:b.keyCode;switch(c){case 13:case 32:if(1===a.gameStatus)return void a.$apply(function(){a.startGame()});break;case 37:a.$apply(function(){a.setAnswer("<")});break;case 39:a.$apply(function(){a.setAnswer(">")});break;case 38:case 40:2===a.gameStatus&&a.$apply(function(){a.skipQuestion()})}}}]),angular.module("easyMath.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]);var easyMathFilters=angular.module("easyMath.filters",[]);easyMathFilters.filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),easyMathFilters.filter("filterAnswered",function(){return function(a){var b={output:[]};return angular.forEach(a,function(a){void 0!==a.answer&&this.output.push(a)},b),b.output}});var easyMathServices=angular.module("easyMath.services",[]);easyMathServices.value("version","0.1"),easyMathServices.service("TimerService",function(a){var b=null,c=null,d=function(a,d){var e=new Date,f=1e3*(60*a+d);c=new Date,b=new Date,c.setTime(e.getTime()+f)},e=function(){var a=new Date;b.setTime(c.getTime()-a.getTime())},f=function(){console.log(b)},g=function(){return b},h=function(a,b){var d=1e3*(60*a+b);c.setTime(c.getTime()+d)};this.init=d,this.tick=e,this.show=f,this.getTime=g,this.addTime=h,this.time=b}),easyMathServices.service("NameService",function(){var a=["Lion","Beef","Bed","Cow","Bananas","Hamster","Rhino","Knife","Tiger","Phone","Dog","Bottle","Squirrel","Crow","Apple","Sheep","Panda","Zebra","Lamp","Giraffe","Chicken","","","",""],b=["impossible","inexpensive","innocent","inquisitive","modern","mushy","odd","open","outstanding","poor","powerful","prickly","puzzled","real","rich","shy","sleepy","stupid","super","talented","tame","tender","tough","uninterested","vast","wandering","wild","wrong"],c=function(a){return Math.floor(Math.random()*a)},d=function(){var d=b[c(b.length)]+" "+a[c(a.length)];return d};this.getName=d}),easyMathServices.service("DatabaseService",function(){var a="p0000001362",b="-",c=new SQLEngine(a,b,"www.rdbhost.com"),d=0,e=function(a,b,d){{var e="SELECT * FROM "+a+" "+b;c.query({callback:d,q:e})}},f=function(a,b,f){e(a,"ORDER BY id DESC LIMIT 1",function(e){b[0]=e.records.rows?parseInt(e.records.rows[0][0])+1:1,d=b[0];{var g="INSERT INTO "+a+" VALUES (%s, %s, %s, %s, %s)";c.query({callback:f,q:g,args:b})}})+1},g=function(){return d};this.getTableData=e,this.addTableData=f,this.getLatestAddedId=g}),easyMathServices.factory("HighScoreService",function(a,b,c,d){var e={};e.timelimitScores=null,e.classicScores=null,e.timelimitUpdated=0,e.classicUpdated=0,e.playerName=d("playerName"),e.classicYourScore=d("classicScore"),e.timelimitYourScore=d("timelimitScore"),console.log(e);var f=function(){a.getTableData("score_classic","ORDER BY SCORE DESC LIMIT 10",function(a){e.classicScores=a.records.rows,e.classicUpdated++})},g=function(){a.getTableData("score_timelimit","ORDER BY SCORE DESC LIMIT 10",function(a){e.timelimitScores=a.records.rows,e.timelimitUpdated++})},h=function(){f(),g()};return e.init=h,e.fetchClassic=f,e.fetchTimelimit=g,e}),easyMathServices.service("SoundsService",function(){var a="sounds/error2-cca3.wav",b="sounds/tick-cca3.wav",c="sounds/complete-cca3.wav",d="sounds/theme-cc0.wav",e=(new Audio(b),null),f=new Audio(b),g=new Audio(a),h=new Audio(c),i=function(){e=new Audio(d),e.setAttribute("preload","auto"),document.body.appendChild(e),e.addEventListener("ended",function(){e.load(),e.play()}),e.load(),f.setAttribute("preload","auto")};i(),this.playTheme=function(){e.load(),e.play()},this.stopTheme=function(){e.pause()},this.playSuccess=function(){f&&(f.currentTime=0),f.play()},this.playError=function(){g&&(g.currentTime=0),g.play()},this.playFinish=function(){h.load(),h.play()},this.mute=function(a){e.muted=a.music,f.muted=a.sounds,g.muted=a.sounds,h.muted=a.sounds}}),easyMathServices.service("QuestionsService",function(){var a=function(a){return Math.floor(Math.random()*a)},b=function(b){return a(b)},c=function(a,b){return parseFloat((Math.random()*a).toPrecision(b))},d=function(a){var d={},e=null,f=null,g=void 0;switch(a){case 1:e=b,f=10;break;case 2:e=b,f=20;break;case 3:e=b,f=50;break;case 4:e=b,f=100;break;case 5:e=c,g=3,f=10;break;case 6:e=c,g=3,f=20;break;case 7:e=c,g=4,f=50;break;case 8:e=c,g=5,f=50;break;case 9:e=c,g=5,f=100;break;default:e=c,g=4,f=500}return d.option1=e(f,g),d.option2=e(f,g),d.answer=void 0,d.isTrue=void 0,d.style=void 0,d},e=function(a,b){var c=a.option1>a.option2?">":"<";return a.isTrue=b==c?!0:!1,a.isTrue=a.option1===a.option2?!0:a.isTrue,a.style=a.isTrue?"progress-bar-success":"progress-bar-danger",a.isTrue};this.getRandom=a,this.generateQuestion=d,this.checkAnswer=e}),easyMathServices.factory("GameClassicFactory",function(a){var b={},c=10,d=300;b.questionPoints=10,b.score=0,b.level=0,b.questions=null,b.currentQuestion=null,b.gameStatus=0,b.time=null,b.QuestionsService=null,b.TimerService=null,b.gameDuration=null;var e=null;b.initGame=function(a,c,d){b.gameStatus=1,b.QuestionsService=a,b.TimerService=c,b.gameDuration=d,b.time=b.TimerService.time};var f=function(){b.questions=[],b.currentQuestion={index:-1},b.score=0,b.level=0,g(),b.TimerService.init(b.gameDuration.min,b.gameDuration.sec)};b.start=function(){f(),b.gameStatus=2,b.nextQuestion(),a.cancel(e),e=a(h,d)};var g=function(){var a=parseInt(b.questions.length);b.level++;for(var d=0;c>d;d++){var e=b.QuestionsService.generateQuestion(b.level);e.index=a+d,b.questions.push(e)}},h=function(){return b.time=b.TimerService.getTime(),b.time<=0?(b.gameStatus=3,b.final={title:"Well done!",message:""},void a.cancel(e)):void b.TimerService.tick()};return b.nextQuestion=function(){var a=b.currentQuestion.index+1;a>=b.questions.length&&g();var c=b.questions[a];b.currentQuestion=c},b.skipQuestion=function(a){a.answer="?",b.nextQuestion()},b});